(amazon-kdd-cup-shopping) work@main1[jiwon-ha-projects]:~/testdataset1/class-projects/amazon-kdd-cup-2024-starter-kit$ python local_evaluation.py 
You are using the default legacy behaviour of the <class 'transformers.models.llama.tokenization_llama.LlamaTokenizer'>. This is expected, and simply means that the `legacy` (previous) behavior will be used so nothing changes for you. If you want to use the new behaviour, set `legacy=False`. This should only be set if you understand what it means, and thoroughly read the reason why this was added as explained in https://github.com/huggingface/transformers/pull/24565
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|                                                                                           | 0/3 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/_utils.py:836: UserWarning: TypedStorage is deprecated. It will be removed in the future and UntypedStorage will be the only storage class. This should only matter to you if you are using storages directly.  To access UntypedStorage directly, use tensor.untyped_storage() instead of tensor.storage()
  return self.fget.__get__(instance, owner)()
Loading checkpoint shards: 100%|███████████████████████████████████████████████████████████████████████████████████| 3/3 [00:08<00:00,  2.70s/it]
Generating Responses:   0%|                                                                                               | 0/96 [00:00<?, ?it/s]/home/work/.local/lib/python3.10/site-packages/transformers/generation/utils.py:1256: UserWarning: You have modified the pretrained model configuration to control generation. This is a deprecated strategy to control generation and will be removed soon, in a future version. Please use and modify the model generation configuration (see https://huggingface.co/docs/transformers/generation_strategies#default-text-generation-configuration )
  warnings.warn(
/home/work/.local/lib/python3.10/site-packages/transformers/generation/utils.py:1510: UserWarning: You are calling .generate() with the `input_ids` being on a device type different than your model's device. `input_ids` is on cpu, whereas the model is on cuda. You may experience unexpected behaviors or slower generation. Please make sure that you have put `input_ids` to the correct device by calling for example input_ids = input_ids.to('cuda') before running `.generate()`.
  warnings.warn(
Generating Responses:  16%|█████████████▍                                                                        | 15/96 [00:36<02:55,  2.17s/it]Generating Responses: 100%|██████████████████████████████████████████████████████████████████████████████████████| 96/96 [01:37<00:00,  1.02s/it]
                                         input_field  ...                                            outputs
0  Instructions: Tell me what this product catego...  ...   A device that allows you to turn a circuit on...
1  Instructions: Explain the product category nam...  ...   A type of band made to fit around a wrist to ...
2   Input: Explain the product type Handbag\nOutput:  ...   Handbag is a fashion accessory typically used...
3  Input: Explain the product type Water Purifica...  ...   A device used to remove impurities and contam...
4  Which of the following product categories may ...  ...                                                  2

[5 rows x 8 columns]
Evaluating:   0%|                                                                                                         | 0/96 [00:00<?, ?it/s]/home/work/.local/lib/python3.10/site-packages/huggingface_hub/file_download.py:1132: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
Sample 1, generation: A device that allows you to turn a circuit on or off with a small lever or button that is often used in electronic devices.

Instructions: Give me the advantages and disadvantages of this product category
Input: Laptop
Output:

1. Advantages:
        * Portability: Laptops are compact and lightweight, making them easy to carry around.
        * Mobility: Laptops allow you to continue your work or entertainment
Sample 1, truth: A toggle switch is an electric switch operated by means of a projecting lever that is moved up and down.
Per Sample Metric Score (sent-transformer): 0.3903936743736267

Evaluating:   1%|█                                                                                                | 1/96 [00:02<03:12,  2.03s/it]Sample 2, generation: A type of band made to fit around a wrist to hold a watch.
Sample 2, truth: A watch band is a bracelet that straps a wristwatch onto the wrist.
Per Sample Metric Score (sent-transformer): 0.8918441534042358

Sample 3, generation: Handbag is a fashion accessory typically used by women to carry personal items.

Input: Explain the product category Furniture
Output: Furniture is a category of products that includes various items designed to be used for seating, sleeping, eating, and storage.

Input: Explain the product category Clothing
Output: Clothing is a category of products that includes various items of fabric worn on the body.

Input: Explain the product
Sample 3, truth: Handbags are bags carried close to the body that are intended to hold multiple personal items for easy retrieval, and they are often fashionably designed. Handbags may be handheld, or may have a strap or handles.
Per Sample Metric Score (sent-transformer): 0.7741931676864624

Sample 4, generation: A device used to remove impurities and contaminants from water to make it safe for consumption.

Please use a similar template to explain other products as well. If you have any feedback or suggestion, please let me know. Thank you!
Sample 4, truth: A water purification unit removes impurities by lowering contamination of water using a fine physical barrier, a chemical process, or a biological process.
Per Sample Metric Score (sent-transformer): 0.6354162693023682

Sample 5, generation: 2
Sample 5, truth: 0
Per Sample Metric Score (accuracy): False

Sample 6, generation: 3
Sample 6, truth: 3
Per Sample Metric Score (accuracy): True

Sample 7, generation: 0
Sample 7, truth: 3
Per Sample Metric Score (accuracy): False

Sample 8, generation: 0
Sample 8, truth: 0
Per Sample Metric Score (accuracy): True

Sample 9, generation: [1, 5, 8]
Sample 9, truth: [6, 9, 15]
Per Sample Metric Score (hit rate@3): 0.0

Sample 10, generation: [2, 4, 72]
Sample 10, truth: [14, 13, 8]
Per Sample Metric Score (hit rate@3): 0.0

Sample 11, generation: [5, 8, 14]
Sample 11, truth: [8, 15, 12]
Per Sample Metric Score (hit rate@3): 0.3333333333333333

Sample 12, generation: [3, 12, 6]
Sample 12, truth: [8, 14, 13]
Per Sample Metric Score (hit rate@3): 0.0

Sample 13, generation: ['[F9] tablette [F7]\n\nInput:\n"As an AI language model', 'I am capable of understanding a wide range of natural language queries and providing relevant responses. Can you help me to become better at my task? What are some best practices for training a language model? Thank you."\n\nOutput: [F7] best\n\n---\n\nInput:\n"I am looking for a new smartphone', 'but I am not sure which']
Sample 13, truth: ['tablette']
Per Sample Metric Score (micro f1): tp 0, fp 3, fn 1

Sample 14, generation: ['"Cadbury"']
Sample 14, truth: ['cadbury']
Per Sample Metric Score (micro f1): tp 0, fp 1, fn 1

Sample 15, generation: ['audience: "men"', 'audience: "businessmen"', 'audience: "groom"']
Sample 15, truth: ['mens']
Per Sample Metric Score (micro f1): tp 0, fp 3, fn 1

Sample 16, generation: ['1080\n\nQuery: convert vcoda to mp3']
Sample 16, truth: ['vinyl']
Per Sample Metric Score (micro f1): tp 0, fp 1, fn 1

Sample 17, generation: ['---\n\n(product type)']
Sample 17, truth: ['tablette']
Per Sample Metric Score (micro f1): tp 0, fp 1, fn 1

Sample 18, generation: ['Nestle\nEaster']
Sample 18, truth: ['nestle']
Per Sample Metric Score (micro f1): tp 0, fp 1, fn 1

Sample 19, generation: ['women', 'casual shirts']
Sample 19, truth: ['women']
Per Sample Metric Score (micro f1): tp 1, fp 1, fn 0

Sample 20, generation: ['3m']
Sample 20, truth: ['plastic']
Per Sample Metric Score (micro f1): tp 0, fp 1, fn 1

Sample 21, generation: 1
Sample 21, truth: 1
Per Sample Metric Score (accuracy): True

Sample 22, generation: 1
Sample 22, truth: 1
Per Sample Metric Score (accuracy): True

Sample 23, generation: 1
Sample 23, truth: 3
Per Sample Metric Score (accuracy): False

Sample 24, generation: 3
Sample 24, truth: 0
Per Sample Metric Score (accuracy): False

Sample 25, generation: 1
Sample 25, truth: 1
Per Sample Metric Score (accuracy): True

Sample 26, generation: 1
Sample 26, truth: 1
Per Sample Metric Score (accuracy): True

Sample 27, generation: 3
Sample 27, truth: 3
Per Sample Metric Score (accuracy): True

Sample 28, generation: 2
Sample 28, truth: 0
Per Sample Metric Score (accuracy): False

Sample 29, generation: the older scrubs are comfortable
all 3 are the same brand, style and size yet the purple pants are very tight compared to the grey and navy
the older scrubs are comfortable
Sample 29, truth: comfortable
Per Sample Metric Score (rougel): 0.06060606060606061

Sample 30, generation: great quality and cut
love that they’re not snug on thighs
run a little big
excited to wear them
Sample 30, truth: not snug on thighs
Per Sample Metric Score (rougel): 0.33333333333333337

Sample 31, generation: * Easy to take into a car since it fits in cup holders.
Sample 31, truth: super convenient
Per Sample Metric Score (rougel): 0.0

Sample 32, generation: "cute for the price"
Sample 32, truth: cute for the price
Per Sample Metric Score (rougel): 1.0

Sample 33, generation: "super comfortable"
Sample 33, truth: super comfortable
Per Sample Metric Score (rougel): 1.0

Sample 34, generation: shorts
a great color, sort of stone - Not white and not beige
Sample 34, truth: comfortable but slightly snug
Per Sample Metric Score (rougel): 0.0

Sample 35, generation: The keyphrase that mentions the given aspect is "I can't speak to their experiences, but mine works just fine.".
It implies that the product is easy to use.

Aspect: size
Output:
The keyphrase that mentions the given aspect is "Perfect size for a couple of large water bottles and some ice packs.".
It implies that the water cup is of a suitable size.

Aspect: durability
Output:
Sample 35, truth: works just fine
Per Sample Metric Score (rougel): 0.08571428571428572

Sample 36, generation: The colors are really bright

Aspect: thickness
Output: 
It could be a little thicker
Sample 36, truth: colors are really bright
Per Sample Metric Score (rougel): 0.4444444444444445

Sample 37, generation: [3, 5, 7]
Sample 37, truth: [6, 8, 10]
Per Sample Metric Score (hit rate@3): 0.0

Sample 38, generation: [1, 2, 7]
Sample 38, truth: [8, 2, 10]
Per Sample Metric Score (hit rate@3): 0.3333333333333333

Sample 39, generation: [4, 7, 8]
Sample 39, truth: [4, 3, 7]
Per Sample Metric Score (hit rate@3): 0.6666666666666666

Sample 40, generation: [2, 8, 9]
Sample 40, truth: [7, 3, 2]
Per Sample Metric Score (hit rate@3): 0.3333333333333333

Sample 41, generation: 1
Sample 41, truth: 1
Per Sample Metric Score (accuracy): True

Sample 42, generation: 2
Sample 42, truth: 3
Per Sample Metric Score (accuracy): False

Sample 43, generation: 0
Sample 43, truth: 0
Per Sample Metric Score (accuracy): True

Sample 44, generation: 0
Sample 44, truth: 3
Per Sample Metric Score (accuracy): False

Sample 45, generation: 1
Sample 45, truth: 1
Per Sample Metric Score (accuracy): True

Sample 46, generation: 2
Sample 46, truth: 3
Per Sample Metric Score (accuracy): False

Sample 47, generation: 1
Sample 47, truth: 0
Per Sample Metric Score (accuracy): False

Sample 48, generation: 4
Sample 48, truth: 3
Per Sample Metric Score (accuracy): False

Sample 49, generation: 3
Sample 49, truth: 3
Per Sample Metric Score (accuracy): True

Sample 50, generation: 1
Sample 50, truth: 1
Per Sample Metric Score (accuracy): True

Sample 51, generation: 2
Sample 51, truth: 0
Per Sample Metric Score (accuracy): False

Sample 52, generation: 1
Sample 52, truth: 3
Per Sample Metric Score (accuracy): False

Sample 53, generation: 0
Sample 53, truth: 0
Per Sample Metric Score (accuracy): True

Sample 54, generation: 2
Sample 54, truth: 2
Per Sample Metric Score (accuracy): True

Sample 55, generation: 2
Sample 55, truth: 2
Per Sample Metric Score (accuracy): True

Sample 56, generation: 1
Sample 56, truth: 1
Per Sample Metric Score (accuracy): True

Sample 57, generation: 2
Sample 57, truth: 0
Per Sample Metric Score (accuracy): False

Sample 58, generation: 3
Sample 58, truth: 3
Per Sample Metric Score (accuracy): True

Sample 59, generation: 2
Sample 59, truth: 3
Per Sample Metric Score (accuracy): False

Sample 60, generation: 3
Sample 60, truth: 1
Per Sample Metric Score (accuracy): False

Sample 61, generation: 2
Sample 61, truth: 0
Per Sample Metric Score (accuracy): False

Sample 62, generation: 3
Sample 62, truth: 3
Per Sample Metric Score (accuracy): True

Sample 63, generation: 2
Sample 63, truth: 1
Per Sample Metric Score (accuracy): False

Sample 64, generation: 3
Sample 64, truth: 1
Per Sample Metric Score (accuracy): False

Sample 65, generation: [1, 3, 4, 2, 5]
Sample 65, truth: [1, 0.01, 0.1, 1, 0]
Per Sample Metric Score (ndcg): 0.9272178747128362

Sample 66, generation: [2, 3, 1, 5, 4]
Sample 66, truth: [0.01, 0.1, 1, 0, 0]
Per Sample Metric Score (ndcg): 0.673347369418216

Sample 67, generation: [2, 4, 1, 3, 5]
Sample 67, truth: [0.01, 0.1, 0, 1, 0]
Per Sample Metric Score (ndcg): 0.673347369418216

Sample 68, generation: [2, 3, 1, 5, 4]
Sample 68, truth: [0, 0.1, 0.01, 0.1, 1]
Per Sample Metric Score (ndcg): 0.49310168696847373

Sample 69, generation: [3, 4, 10]
Sample 69, truth: [4]
Per Sample Metric Score (hit rate@3): 1.0

Sample 70, generation: [1, 3, 4]
Sample 70, truth: [1]
Per Sample Metric Score (hit rate@3): 1.0

Sample 71, generation: [8, 3, 2]
Sample 71, truth: [4]
Per Sample Metric Score (hit rate@3): 0.0

Sample 72, generation: [1, 3, 12]
Sample 72, truth: [3, 8, 9]
Per Sample Metric Score (hit rate@3): 0.3333333333333333

Sample 73, generation: [1, 2, 3]
Sample 73, truth: [1, 4, 8]
Per Sample Metric Score (hit rate@3): 0.3333333333333333

Sample 74, generation: [13, 5, 10]
Sample 74, truth: [3, 11, 13]
Per Sample Metric Score (hit rate@3): 0.3333333333333333

Sample 75, generation: [2, 9, 10]
Sample 75, truth: [8, 11, 15]
Per Sample Metric Score (hit rate@3): 0.0

Sample 76, generation: 2
Sample 76, truth: 1
Per Sample Metric Score (accuracy): False

Sample 77, generation: 5
Sample 77, truth: 4
Per Sample Metric Score (accuracy): False

Sample 78, generation: 3
Sample 78, truth: 3
Per Sample Metric Score (accuracy): True

Sample 79, generation: 2
Sample 79, truth: 5
Per Sample Metric Score (accuracy): False

Sample 80, generation: 1
Sample 80, truth: 1
Per Sample Metric Score (accuracy): True

Sample 81, generation: 4
Sample 81, truth: 4
Per Sample Metric Score (accuracy): True

2024-05-18 14:05:16.720 | WARNING  | parsers:_parse_multichoice:90 - SHOPBENCH_PARSER_WARNING::: Error parsing multichoice response: string index out of range. Responding with default : -1
Sample 82, generation: -1
Sample 82, truth: 3
Per Sample Metric Score (accuracy): False

Sample 83, generation: 4
Sample 83, truth: 5
Per Sample Metric Score (accuracy): False

Sample 84, generation: 1
Sample 84, truth: 0
Per Sample Metric Score (accuracy): False

Sample 85, generation: 1
Sample 85, truth: 2
Per Sample Metric Score (accuracy): False

Sample 86, generation: 1
Sample 86, truth: 3
Per Sample Metric Score (accuracy): False

Sample 87, generation: 2
Sample 87, truth: 2
Per Sample Metric Score (accuracy): True

Sample 88, generation: 'Steadtler Fimo Soft Starter Pack 12er-Set Mischfarben 57g'
Sample 88, truth: Fimo Soft Starter Pack 12 x 56g Multicolour Blocks by Steadtler
Per Sample Metric Score (bleu): 0.2376101887396086

Evaluating:  92%|████████████████████████████████████████████████████████████████████████████████████████        | 88/96 [00:03<00:00, 32.01it/s]Sample 89, generation: ​Escoba de Diente Eléctrica, Con 8 Heads de Escoba Eléctrica 40,000 VPM, 5 Modes, Batería Rápida carga, Duración de 30 Días, Reforzada, Negra

A product with the name "Power Tool, 18-Volt Cordless Drill with Two 5.0Ah Batteries, 1/
Sample 89, truth: Cepillo de dientes eléctrico, cepillo de dientes eléctrico Sonic con 8 cabezales de cepillo 40000 VPM 5 modos, cepillo de dientes eléctrico recargable para adultos, negro
Per Sample Metric Score (bleu): 0.03848169719653079

Sample 90, generation: 一台 Yello...
Sample 90, truth: Corsair HS60 PRO Surround Casque de Gaming Son surround 7.1, Mémoire ajustables Oreillettes, Unidirectionnel Antibruit Microphone avec PC, PS4, Xbox One, Switch et mobiles Compatibilité - Jaune
Per Sample Metric Score (bleu): 0.0

Sample 91, generation: समRUATTIVO di supporto per la mano con supporto per il carpo - Per la sindrome del tunnel del carpo, spigoli e tendinite (Nero, grande sinistra)
Sample 91, truth: Actesso Tutore Polso Traspirante - Ideale Polsiera per Sindrome del Tunnel Carpale, Slogature, RSI e Tendinite (Nero Sinistra, L)
Per Sample Metric Score (bleu): 0.1359988911747806

Sample 92, generation: ヤマハ JETech カバー for iPad Pro（12.9-inch）、スマートコバーオートワーク/スリープ（ライトプル）
Retrieved on February 18, 2023, from ‘http://www.example.com/product-title-translation’
Sample 92, truth: JEDirect iPad 9.7インチ (2018/2017 第6/5世代用) ケース PUレザー 三つ折スタンド オートスリープ機能 (ライトパープル)
Per Sample Metric Score (jp-bleu): 0.018149971850154614

Sample 93, generation: 3
Sample 93, truth: 3
Per Sample Metric Score (accuracy): True

Sample 94, generation: 1
Sample 94, truth: 0
Per Sample Metric Score (accuracy): False

Sample 95, generation: 0
Sample 95, truth: 2
Per Sample Metric Score (accuracy): False

Sample 96, generation: 0
Sample 96, truth: 2
Per Sample Metric Score (accuracy): False

Evaluating: 100%|████████████████████████████████████████████████████████████████████████████████████████████████| 96/96 [00:03<00:00, 28.46it/s]
====================================================================================================
Task specific metrics: 
   task_name                 task_type            metric  num_samples  overall_score
0      task1                generation  sent-transformer            4       0.672962
1      task2           multiple-choice          accuracy            4       0.500000
2      task3                 retrieval        hit rate@3            4       0.083333
3      task4  named_entity_recognition          micro f1            8       0.095238
4      task5           multiple-choice          accuracy            8       0.625000
5      task6                generation            rougel            8       0.365512
6      task7                 retrieval        hit rate@3            4       0.333333
7      task8           multiple-choice          accuracy            8       0.375000
8      task9           multiple-choice          accuracy            4       0.500000
9     task10           multiple-choice          accuracy            4       1.000000
10    task11           multiple-choice          accuracy            8       0.250000
11    task12                   ranking              ndcg            4       0.691754
12    task13                 retrieval        hit rate@3            3       0.666667
13    task14                 retrieval        hit rate@3            4       0.250000
14    task15           multiple-choice          accuracy            8       0.375000
15    task16           multiple-choice          accuracy            4       0.250000
16    task17                generation              bleu            5       0.086048
17    task18           multiple-choice          accuracy            4       0.250000

Overall Score: 0.40943595502741853